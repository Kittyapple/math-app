<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ•°å­—å® ç‰©å¤§å†’é™©</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ff9800">
    <style>
        :root { --primary-color: #ff9800; --bg-color: #f0f4f8; }
        * { box-sizing: border-box; }
        body { 
            font-family: sans-serif; 
            background-color: var(--bg-color); 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
            overflow: hidden; /* é˜²æ­¢æ•´ä½“æ»šåŠ¨ï¼Œå†…éƒ¨è‡ªé€‚åº” */
            touch-action: manipulation; 
        }
        
        /* é¡¶éƒ¨çŠ¶æ€æ  - ç¼©å°é«˜åº¦ */
        .header { 
            padding: 10px; 
            background: white; 
            display: flex; 
            justify-content: space-around; 
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
        }

        /* å® ç‰©åŒºåŸŸ - å‹ç¼©é«˜åº¦ç¡®ä¿é”®ç›˜å¯è§ */
        #pet-container { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            min-height: 120px;
        }
        #pet-avatar { font-size: 60px; margin-bottom: 5px; animation: bounce 2s infinite; }
        #pet-name { background: var(--primary-color); color: white; padding: 2px 12px; border-radius: 15px; font-size: 12px; }
        
        .progress-container { width: 60%; height: 8px; background: #ddd; border-radius: 4px; margin: 8px 0; overflow: hidden; }
        #progress-bar { width: 0%; height: 100%; background: #4caf50; transition: width 0.3s; }

        /* é¢˜ç›®åŒºåŸŸ */
        .question-box { background: white; width: 95%; border-radius: 15px; padding: 15px; text-align: center; margin: 5px auto; }
        #question-text { font-size: 28px; color: #333; margin-bottom: 10px; }
        #user-input { font-size: 24px; border: 2px solid #ddd; border-radius: 8px; width: 100px; text-align: center; padding: 5px; background: #f9f9f9; pointer-events: none; }

        /* é”®ç›˜åŒºåŸŸ - ç´§å‡‘å‹ */
        .numpad { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 8px; 
            width: 95%; 
            margin: 0 auto 15px;
        }
        .numpad button { 
            padding: 12px; 
            font-size: 20px; 
            background: white; 
            border: 1px solid #ddd; 
            border-radius: 10px; 
            box-shadow: 0 2px 0 #ccc;
        }
        .numpad button:active { transform: translateY(2px); box-shadow: none; background: #eee; }
        
        /* ç¡®å®šæŒ‰é’® - é†’ç›®ä¸”å¿…è§ */
        .submit-btn { 
            grid-column: span 2; 
            background: var(--primary-color) !important; 
            color: white !important; 
            font-weight: bold;
            border: none !important;
        }
        .clear-btn { background: #f44336 !important; color: white !important; border: none !important; }

        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    </style>
</head>
<body>
    <div class="header">
        <span>ç­‰çº§: <span id="level-val">0</span></span>
        <span>ç»éªŒ: <span id="xp-val">0</span></span>
        <span>è¿å‡»: ğŸ”¥<span id="combo-val">0</span></span>
    </div>

    <div id="pet-container">
        <div id="pet-avatar">ğŸ¥š</div>
        <div id="pet-name">èŒèŒè›‹</div>
        <div class="progress-container"><div id="progress-bar"></div></div>
    </div>

    <div class="question-box">
        <div id="question-text">å‡†å¤‡å¥½äº†å—ï¼Ÿ</div>
        <input type="text" id="user-input" readonly placeholder="?">
    </div>

    <div class="numpad">
        <button onclick="pressNum(1)">1</button>
        <button onclick="pressNum(2)">2</button>
        <button onclick="pressNum(3)">3</button>
        <button onclick="pressNum(4)">4</button>
        <button onclick="pressNum(5)">5</button>
        <button onclick="pressNum(6)">6</button>
        <button onclick="pressNum(7)">7</button>
        <button onclick="pressNum(8)">8</button>
        <button onclick="pressNum(9)">9</button>
        <button class="clear-btn" onclick="clearInput()">C</button>
        <button onclick="pressNum(0)">0</button>
        <button class="submit-btn" onclick="checkAnswer()">ç¡®å®šæ£€æŸ¥</button>
    </div>

    <script>
        const stages = [
            {threshold:0, name:"èŒèŒè›‹", icon:"ğŸ¥š"},
            {threshold:100, name:"å¹¼è‹—æœŸ", icon:"ğŸ£"},
            {threshold:300, name:"æˆé•¿æœŸ", icon:"ğŸ¥"},
            {threshold:800, name:"è¿›åŒ–æœŸ", icon:"ğŸ¦…"},
            {threshold:2000, name:"å¹»å…½æœŸ", icon:"ğŸ²"}
        ];

        let state = JSON.parse(localStorage.getItem('math_pet_save')) || {xp:0, combo:0, level:0};
        let currentAnswer = 0;

        function newQuestion() {
            const a = Math.floor(Math.random() * 10) + 1;
            const b = Math.floor(Math.random() * 10) + 1;
            const op = Math.random() > 0.5 ? '+' : '-';
            
            if(op === '-' && a < b) {
                currentAnswer = b - a;
                document.getElementById('question-text').innerText = `${b} - ${a} = ?`;
            } else {
                currentAnswer = op === '+' ? a + b : a - b;
                document.getElementById('question-text').innerText = `${a} ${op} ${b} = ?`;
            }
            document.getElementById('user-input').value = "";
        }

        function pressNum(n) {
            const input = document.getElementById('user-input');
            if (input.value.length < 3) input.value += n;
        }

        function clearInput() {
            document.getElementById('user-input').value = "";
        }

        function checkAnswer() {
            const val = parseInt(document.getElementById('user-input').value);
            if(isNaN(val)) return;

            if(val === currentAnswer) {
                state.combo++;
                state.xp += (10 + (state.combo > 3 ? 5 : 0));
                // éœ‡åŠ¨åé¦ˆ (å¦‚æœè®¾å¤‡æ”¯æŒ)
                if (navigator.vibrate) navigator.vibrate(50);
                newQuestion();
            } else {
                state.combo = 0;
                alert("ä¸å¯¹å“¦ï¼Œå†ç®—ç®—çœ‹ï¼åŠ æ²¹ï¼");
                clearInput();
            }
            checkEvolution();
            updateUI();
            save();
        }

        function checkEvolution() {
            let lvl = 0;
            stages.forEach((s, i) => { if(state.xp >= s.threshold) lvl = i; });
            if(lvl > state.level) {
                state.level = lvl;
                alert(`âœ¨ æ­å–œï¼ä½ çš„å® ç‰©è¿›åŒ–æˆäº†ã€${stages[lvl].name}ã€‘ï¼`);
            }
        }

        function updateUI() {
            document.getElementById('xp-val').innerText = state.xp;
            document.getElementById('level-val').innerText = state.level;
            document.getElementById('combo-val').innerText = state.combo;
            document.getElementById('pet-avatar').innerText = stages[state.level].icon;
            document.getElementById('pet-name').innerText = stages[state.level].name;
            
            const next = stages[state.level+1] ? stages[state.level+1].threshold : state.xp + 100;
            const prev = stages[state.level].threshold;
            const progress = ((state.xp - prev) / (next - prev)) * 100;
            document.getElementById('progress-bar').style.width = Math.min(progress, 100) + "%";
        }

        function save() { localStorage.setItem('math_pet_save', JSON.stringify(state)); }

        // å¯åŠ¨
        newQuestion();
        updateUI();
    </script>
</body>
</html>
